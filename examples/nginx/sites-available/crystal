server {
	server_name www.crystal.you crystal.you;
	return 301 https://crystal.you$request_uri;
}

server {
	listen 443 ssl http2;
	ssl_certificate /etc/letsencrypt/live/crystal.you/fullchain.pem; # managed by Certbot
	ssl_certificate_key /etc/letsencrypt/live/crystal.you/privkey.pem; # managed by Certbot
	server_name www.crystal.you;
	return 301 https://crystal.you$request_uri;
}

server {
	server_name crystal.you www.crystal.you;
	# Limit the maximum size of files that can be uploaded via POST requests
	client_max_body_size 5M;
	# security
	include /etc/nginx/nginxconf/security.conf;
	# /security
	location /
	{
		root /var/www/Crystal-main/frontend/dist;
		try_files $uri $uri /index.html;
	}
	location /api/
	{
		proxy_pass http://localhost:3000/;
		proxy_hide_header X-Powered-By;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection 'upgrade';
		proxy_set_header Host $host;
		proxy_cache_bypass $http_upgrade;
	}

	listen [::]:443 ssl ipv6only=on; # managed by Certbot
	listen 443 ssl http2; # managed by Certbot
	ssl_certificate /etc/letsencrypt/live/crystal.you/fullchain.pem; # managed by Certbot
	ssl_certificate_key /etc/letsencrypt/live/crystal.you/privkey.pem; # managed by Certbot
	include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
